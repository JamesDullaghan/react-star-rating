"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}(),_get=function(t,e,a){for(var i=!0;i;){var n=t,r=e,s=a;o=u=l=void 0,i=!1;var o=Object.getOwnPropertyDescriptor(n,r);if(void 0!==o){if("value"in o)return o.value;var l=o.get;return void 0===l?void 0:l.call(s)}var u=Object.getPrototypeOf(n);if(null===u)return void 0;t=u,e=r,a=s,i=!0}},_react=require("react"),_react2=_interopRequireDefault(_react),StarRating=function(t){function e(t){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.state={ratingCache:{pos:0,rating:0},editing:t.editing||!0,stars:5,rating:0,pos:0,glyph:this.getStars()}}return _inherits(e,t),_createClass(e,[{key:"getStars",value:function(){for(var t="",e=this.props.ratingAmount,a=0;e>a;a++)t+="â˜…";return t}},{key:"componentWillMount",value:function(){if(this.min=0,this.max=this.props.ratingAmount||5,this.props.rating){this.state.editing=!1;var t=this.props.rating;this.setState({rating:t,pos:this.getStarRatingPosition(t)})}}},{key:"componentDidMount",value:function(){this.root=this.refs.root.getDOMNode(),this.ratingStars=this.refs.ratingStars.getDOMNode(),this.ratingContainer=this.refs.ratingContainer.getDOMNode()}},{key:"componentWillUnmount",value:function(){delete this.root,delete this.ratingStars,delete this.ratingContainer}},{key:"getPosition",value:function(t){return t.pageX-this.root.getBoundingClientRect().left}},{key:"applyPrecision",value:function(t,e){return parseFloat(t.toFixed(e))}},{key:"getDecimalPlaces",value:function(t){var e=(""+t).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return e?Math.max(0,(e[1]?e[1].length:0)-(e[2]?+e[2]:0)):0}},{key:"getWidthFromValue",value:function(t){var e=this.min,a=this.max;return e>=t||e===a?0:t>=a?100:100*(t-e)/(a-e)}},{key:"getValueFromPosition",value:function(t){var e=this.getDecimalPlaces(this.props.step),a=this.ratingContainer.offsetWidth,i=this.max-this.min,n=i*t/(a*this.props.step);n=Math.ceil(n);var r=this.applyPrecision(parseFloat(this.min+n*this.props.step),e);return r=Math.max(Math.min(r,this.max),this.min)}},{key:"calculate",value:function(t){var e=this.getValueFromPosition(t),a=this.getWidthFromValue(e);return a+="%",{width:a,val:e}}},{key:"getStarRatingPosition",value:function(t){var e=this.getWidthFromValue(t)+"%";return e}},{key:"getRatingEvent",value:function(t){var e=this.getPosition(t);return this.calculate(e)}},{key:"handleMouseLeave",value:function(){this.setState({pos:this.state.ratingCache.pos,rating:this.state.ratingCache.rating})}},{key:"handleMouseMove",value:function(t){var e=this.getRatingEvent(t);this.setState({pos:e.width,rating:e.val})}},{key:"shouldComponentUpdate",value:function(t,e){return e.ratingCache.rating!==this.state.ratingCache.rating||e.rating!==this.state.rating}},{key:"handleClick",value:function(t){if(this.props.disabled)return t.stopPropagation(),t.preventDefault(),!1;var e={pos:this.state.pos,rating:this.state.rating,caption:this.props.caption,name:this.props.name};this.setState({ratingCache:e}),this.props.onRatingClick(t,e)}},{key:"treatName",value:function(t){return"string"==typeof t?t.toLowerCase().split(" ").join("_"):void 0}},{key:"getClasses",value:function(){var t=["react-star-rating__root"];if(this.props.disabled&&t.push("rating-disabled"),this.props.size)switch(this.props.size){case"sm":t.push("react-star-rating__size--sm");break;case"md":t.push("react-star-rating__size--md");break;case"lg":t.push("react-star-rating__size--lg")}return this.state.editing&&t.push("rating-editing"),t.join(" ")}},{key:"render",value:function(){var t=null;this.props.caption&&(t=_react2["default"].createElement("span",{className:"react-rating-caption"},this.props.caption));var e,a=this.getClasses();return e=this.state.editing?_react2["default"].createElement("div",{ref:"ratingContainer",className:"rating-container rating-gly-star","data-content":this.state.glyph,onMouseMove:this.handleMouseMove.bind(this),onMouseLeave:this.handleMouseLeave.bind(this),onClick:this.handleClick.bind(this)},_react2["default"].createElement("div",{ref:"ratingStars",className:"rating-stars","data-content":this.state.glyph,style:{width:this.state.pos}}),_react2["default"].createElement("input",{type:"number",name:this.props.name,value:this.state.ratingCache.rating,style:{display:"none !important"},min:this.min,max:this.max,readOnly:!0})):_react2["default"].createElement("div",{ref:"ratingContainer",className:"rating-container rating-gly-star","data-content":this.state.glyph},_react2["default"].createElement("div",{ref:"ratingStars",className:"rating-stars","data-content":this.state.glyph,style:{width:this.state.pos}}),_react2["default"].createElement("input",{type:"number",name:this.props.name,value:this.state.ratingCache.rating,style:{display:"none !important"},min:this.min,max:this.max,readOnly:!0})),_react2["default"].createElement("span",{className:"react-star-rating"},t,_react2["default"].createElement("span",{ref:"root",className:a},e))}}]),e}(_react2["default"].Component);StarRating.propTypes={name:_react2["default"].PropTypes.string.isRequired,caption:_react2["default"].PropTypes.string,ratingAmount:_react2["default"].PropTypes.number.isRequired,rating:_react2["default"].PropTypes.number,onRatingClick:_react2["default"].PropTypes.func,disabled:_react2["default"].PropTypes.bool,editing:_react2["default"].PropTypes.bool,size:_react2["default"].PropTypes.string},StarRating.defaultProps={step:.5,ratingAmount:5,onRatingClick:function(){},disabled:!1},exports["default"]=StarRating,module.exports=exports["default"];